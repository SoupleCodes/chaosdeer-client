/* rly fucking small doom implementation i stole */
/*https://bookmarkl.ink/ashtonmeuser/04710d3befc446e849108a58755163ea*/(()=>{var u=`@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes pulse{0%{border-top:8px solid black}to{border-top:4px solid black}}dialog{display:flex;flex-direction:column;outline:none;border:none;pointer-events:all!important;padding:0;font-family:Arial,sans-serif;line-height:1.6;background-color:#f9fafb;color:#262626;max-width:min(calc(100vw - 4em),50em);*{box-sizing:border-box}>div:first-child>div>.spinner{margin:0 auto;width:40px;height:40px;border:4px solid #ccc;border-radius:50%;animation:spin 1s linear infinite,pulse .33s ease-in-out infinite alternate}>div:last-child{font-size:.8em;color:#aaa;padding:0 2rem;>a{color:inherit;text-decoration:underline}}&::backdrop{-webkit-backdrop-filter:blur(6px) grayscale(75%) brightness(60%);backdrop-filter:blur(6px) grayscale(75%) brightness(60%)}}
`;var f=class extends Error{},l=t=>typeof t=="string"?t=document.createRange().createContextualFragment(t):t,a=class t{dialogElement;containerElement;footerElement;styleElement;_onClose=[];constructor(e="bookmarklet-modal",i){if(document.getElementById(e))throw new f("modal already exists");let r=l(`<div id="${e}" style="all:initial;position:fixed;width:0;height:0;opacity:0;"></div>`).firstChild,s=r.attachShadow({mode:"open"});this.dialogElement=l('<dialog style="border-radius:1em;"><div><div style="margin:2em;"></div></div><div></div></dialog>').firstChild,this.containerElement=this.dialogElement.firstChild.firstChild,this.footerElement=this.dialogElement.lastChild,this.styleElement=Object.assign(document.createElement("style")),this.dialogElement.addEventListener("click",o=>{o.target instanceof HTMLDialogElement&&o.target.close()}),this.dialogElement.addEventListener("close",()=>this._onClose.forEach(o=>o())),this.onClose(()=>r.remove()),this.update(i),s.appendChild(Object.assign(document.createElement("style"),{textContent:u})),s.appendChild(this.styleElement),s.appendChild(this.dialogElement),document.body.appendChild(r),this.dialogElement.showModal()}set loading(e){e!==void 0&&(e===!1?this.containerElement.replaceChildren():this.containerElement.replaceChildren(...[Object.assign(document.createElement("div"),{className:"spinner"}),e].filter(i=>typeof i!="boolean")))}set content(e){e!==void 0&&this.containerElement.replaceChildren(l(e))}set padding(e){e!==void 0&&(this.containerElement.style.margin=e,this.dialogElement.style.borderRadius=e==="0"?e:`calc(${e} / 2)`)}set footer(e){e!==void 0&&this.footerElement.replaceChildren(l(e))}set style(e){e!==void 0&&(this.styleElement.textContent=e)}static factory(e,i){try{return new t(e,i)}catch{return null}}update(e){this.loading=e?.loading,this.content=e?.content,this.padding=e?.padding,this.footer=e?.footer,this.style=e?.style,this.onClose(e?.onClose)}onClose(e){e&&this._onClose.unshift(e)}};async function x(t){return await WebAssembly.instantiateStreaming(fetch("https://cdn.jsdelivr.net/gh/ashtonmeuser/godot-wasm-doom/doom.wasm"),t)}function C(){let t={Enter:13,Backspace:127,Space:32,ArrowLeft:172,ArrowRight:174,ArrowUp:173,ArrowDown:175,ControlLeft:157,AltLeft:184,Escape:27,Tab:9,ShiftLeft:16};for(let e=0;e<26;e++)t[`Key${String.fromCharCode(65+e)}`]=97+e;for(let e=0;e<=9;e++)t[`Digit${e}`]=48+e;for(let e=1;e<=12;e++)t[`F${e}`]=186+e;return t}(async()=>{let t={x:640,y:400},e=document.createRange().createContextualFragment(`<canvas width="${t.x}" height="${t.y}" style="display:block;max-width:100%"></canvas>`).firstChild,i=a.factory("fa254175-320c-416a-b1fe-ba525876afa0",{content:e,padding:"0",style:`dialog{aspect-ratio:${t.x}/${t.y}}`});if(!i)return;let r=new WebAssembly.Memory({initial:108}),s=n=>e.getContext("2d")?.putImageData(new ImageData(n,t.x,t.y),0,0),o=n=>(c,E)=>n(new TextDecoder("utf8").decode(new Uint8Array(r.buffer,c,E))),h=C(),y={js:{js_console_log:o(console.info),js_stdout:o(console.info),js_stderr:o(console.warn),js_milliseconds_since_start:()=>performance.now(),js_draw_screen:n=>{var c=new Uint8ClampedArray(r.buffer,n,t.x*t.y*4);s(c)}},env:{memory:r}},{instance:b}=await x(y),m=b.exports,d=n=>{m.add_browser_event(n.type==="keydown"?0:1,h[n.code]),n.preventDefault()};window.addEventListener("keydown",d),window.addEventListener("keyup",d);let p=!0;i.onClose(()=>{p=!1,window.removeEventListener("keydown",d),window.removeEventListener("keyup",d)}),m.main();function g(){p&&(m.doom_loop_step(),window.requestAnimationFrame(g))}window.requestAnimationFrame(g)})();})();
